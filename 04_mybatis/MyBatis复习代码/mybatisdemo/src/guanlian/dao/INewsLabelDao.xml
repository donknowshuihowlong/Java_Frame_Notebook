<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="guanlian.dao.INewsLabelDao">
	<!-- 1. 查询出指定栏目的所有子孙栏目 -->
	<!-- 形成递归查询，每次查询结果继续调用 -->
	<resultMap type="NewsLabel" id="NewLabelMapper1">
		<id column="id" property="id"/>
		<result column="name" property="name"/>
		<!-- 这个id需要靠根据pid查询出来的id传入 -->
		<collection property="children" 
			ofType="NewsLable"
			select="selectChildrenByParentId"
			column="id"
		/>
	</resultMap>
	<!-- 根据pid查询子栏目 -->
	<select id="selectChildrenByParentId" resultMap="NewLabelMapper1">
		select id,name
		from newslabel
		where pid=#{xxx}
	</select>
	<!-- 2. 查询出指定栏目以及所有子孙栏目 -->
	<!-- 流程分析
		1. 使用selectNewsLabelById查出最顶层栏目的id
		2. 传递给上面定义的递归方法进行查询
	 -->
	 <select id="selectNewsLabelById" resultMap="NewLabelMapper1">
	 	select id,name
	 	from newslabel
	 	where id=#{yyy}
	 </select>
	 
	 
	<!-- 多对一处理 -->
	<resultMap type="NewsLabel" id="NewLabelMapper2">
		<id column="id" property="id"/>
		<result column="name" property="name"/>
		<!-- 这个pid需要靠根据id查询出来的pid传入 -->
		<collection property="parent" 
			ofType="NewsLable"
			select="selectParentByParentId"
			column="pid"
		/>
	</resultMap>
	 <select id="selectParentByParentId" resultMap="NewLabelMapper2">
	 	select id,name,pid
	 	from newslabel
	 	where id=#{yyy}
	 </select>
	
</mapper>
